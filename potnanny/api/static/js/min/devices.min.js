const DEVICE_DEFAULT={name:null,room_id:null,interface:null,attributes:{},reports:[],plugin:{}};var Device={list:[],current:DEVICE_DEFAULT,loadList:function(){let e=API_URI+"/devices";return fetch(e,{method:"GET",credentials:"same-origin",headers:{"X-CSRF-Token":CSRF_TOKEN,"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json();throw"response was not ok"})).then((function(e){Device.list=e.msg})).catch((function(e){console.log(e)}))},load:function(e){Device.current=DEVICE_DEFAULT;for(let t of Device.list)if(t.id==e){Device.current=t;break}},save:function(){let e="POST",t=API_URI+"/devices";return Device.current.id&&(e="PATCH",t+="/"+Device.current.id),fetch(t,{method:e,credentials:"same-origin",headers:{"X-CSRF-Token":CSRF_TOKEN,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(Device.current)}).then((function(e){if(e.ok)return e.json();throw"response was not ok"})).then((function(e){Device.current=e.msg,Device.loadList()})).catch((function(e){console.log(e)}))},delete:function(){let e=API_URI+"/devices/"+Device.current.id;return fetch(e,{method:"DELETE",credentials:"same-origin",headers:{"X-CSRF-Token":CSRF_TOKEN,"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json();throw"response was not ok"})).then((function(e){Device.current=DEVICE_DEFAULT,Device.loadList()})).catch((function(e){console.log(e)}))},pollCurrent:function(e=void 0){e||(e=Device.current.id);let t=API_URI+"/devices/"+e+"/poll";return console.log(t),fetch(t,{method:"POST",credentials:"same-origin",headers:{"X-CSRF-Token":CSRF_TOKEN}}).then((function(e){if(e.ok)return e.json();throw"response was not ok"})).then((function(e){e.msg})).catch((function(e){console.log(e)}))},scanKeycodePromise:function(){let e=API_URI+"/devices/"+Device.current.id+"/keycode";return fetch(e,{method:"GET",credentials:"same-origin",headers:{"X-CSRF-Token":CSRF_TOKEN,"Content-Type":"application/json",Accept:"application/json"}})},switchDevice:function(e,t,n){Device.load(e);let o=API_URI+"/devices/"+e+"/"+t;return o+=0==n?"/off":"/on",fetch(o,{method:"POST",credentials:"same-origin",headers:{"X-CSRF-Token":CSRF_TOKEN,"Content-Type":"application/json",Accept:"application/json"}}).then((function(e){if(e.ok)return e.json();throw"response was not ok"})).then((function(e){e.msg})).catch((function(e){console.log(e)}))}},deviceNameModal=function(e=void 0){e&&Device.load(Number(e));let t=m("form",{onsubmit:function(e){e.preventDefault(),hideModal(),Device.save(),setTimeout((function(){Device.loadList()}),300),setTimeout((function(){window.location.reload()}),500)}},[m("input[type=text][required][placeholder=Device Name].form-control",{id:"devicename",value:Device.current.name,onchange:function(e){Device.current.name=e.target.value}}),m("button[type=submit].submit.btn.btn-primary.mt-2.float-right","Save")]);showModal(t)},deviceFormModal=function(e){Device.load(e);var t=m("form",{onsubmit:function(e){e.preventDefault(),setTimeout((function(){Device.pollCurrent(Device.current.id)}),200),Device.save(),hideModal(),setTimeout((function(){window.location.reload()}),6e3)}},[m("input[type=text][required].form-control",{id:"name",value:Device.current.name,onchange:function(e){Device.current.name=e.target.value}}),m("label[for=room].form-label.mt-3","Room Assignment"),m("select.form-select",{id:"room",onchange:function(e){!0,Device.current.room_id=parseInt(e.target.value)}},[Room.list.map((function(e){return m(e.id==Device.current.room_id?"option[selected]":"option",{value:e.id},e.name)})),m(null==Device.current.room_id?"option[selected]":"option",{value:null},"")]),"is_key_required"in Device.current.plugin&&1==Device.current.plugin.is_key_required?m("div.input-group.mt-3",[m("input[type=text][required][placeholder=Key Code]",{id:"key_code",class:"form-control",value:Device.current.attributes.key_code,disabled:null!=Device.current.attributes.key_code,onchange:function(e){Device.current.attributes.key_code=e.target.value}}),m("button.btn.btn-outline-primary",{onclick:function(e){e.preventDefault(),this.disabled=!0;let t=document.getElementById("key_code");alert("The light on the outlet will blink blue. Once that happens, press the button on the outlet 3-4 times"),Device.scanKeycodePromise().then((function(e){if(e.ok)return e.json()})).then((function(e){let n=e.msg;t.value=n,t.disabled=!0,Device.current.attributes.key_code=n})).catch((function(e){console.log(e)})),this.disabled=!1}},"Capture")]):null,m("div.mt-4.row.row-cols-2.mt-2",[m("div.col",[m("label[for=plugin1].form-label","Plugin"),m("input[type=text][disabled].form-control",{id:"plugin1",value:Device.current.interface})]),m("div.col",[m("label[for=address1].form-label","Address"),"address"in Device.current.attributes?m("input[type=text][disabled].form-control",{id:"address1",value:Device.current.attributes.address}):null])]),m("div.mt-4.row.row-cols-2",[m("div.col",m("button[type=submit].submit.btn.btn-primary.form-control","Save")),m("div.col",m("button.btn.btn-outline-danger.form-control",{onclick:function(e){e.preventDefault(),confirm("Are you sure you want to delete this device and all of its data?")&&(Device.delete(),hideModal(),setTimeout((function(){window.location.reload()}),3e3))}},"Delete"))])]);showModal(t)};setTimeout((function(){Device.loadList()}),300);
